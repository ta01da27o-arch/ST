<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>STシミュレーター</title>
<style>
html, body {
  margin: 0;
  padding: 0;
  height: 100%;
  width: 100%;
  overflow: hidden;
  font-family: sans-serif;
  background-color: #ffffff; /* 枠外白 */
}
.table-container {
  display: flex;
  flex-direction: column;
  justify-content: space-between;
  height: 100%;
  padding: 10px;
  gap: 10px;
}
.panel {
  background-color: #00bfff; /* 枠内ディープスカイブルー */
  padding: 5px;
  border: 2px solid #00796b;
  border-radius: 10px;
  display: flex;
  flex-direction: row;
  position: relative;
  flex: 1;
  max-height: calc(50% - 14px);
}
.line {
  position: absolute;
  left: 50%;
  top: 0;
  bottom: 0;
  width: 2px;
  background-color: black;
}
.number-labels {
  display: flex;
  flex-direction: column;
  justify-content: space-around;
  height: 100%;
  width: 20px;
}
.circles-column {
  display: flex;
  flex-direction: column;
  justify-content: space-around;
  flex: 1;
  position: relative;
}
.circle {
  width: 24px;
  height: 24px;
  border-radius: 50%;
  cursor: grab;
  position: absolute;
  transition: transform 0.1s;
}
.inputs-column {
  display: flex;
  flex-direction: column;
  justify-content: space-around;
  height: 100%;
  width: 60px;
}
.inputs-column input {
  width: 100%;
  padding: 5px;
  text-align: center;
  font-size: 0.9rem;
}
</style>
</head>
<body>

<div class="table-container">

  <!-- 上段（平均） -->
  <div class="panel" id="average-panel">
    <div class="line"></div>
    <div class="number-labels">
      <div>1</div><div>2</div><div>3</div><div>4</div><div>5</div><div>6</div>
    </div>
    <div class="circles-column" id="average-circles">
      <span class="circle" style="background:white;" data-index="0"></span>
      <span class="circle" style="background:black;" data-index="1"></span>
      <span class="circle" style="background:red;" data-index="2"></span>
      <span class="circle" style="background:blue;" data-index="3"></span>
      <span class="circle" style="background:yellow;" data-index="4"></span>
      <span class="circle" style="background:green;" data-index="5"></span>
    </div>
    <div class="inputs-column" id="average-inputs">
      <input type="text" id="avg1" placeholder="-2.00">
      <input type="text" id="avg2" placeholder="-2.00">
      <input type="text" id="avg3" placeholder="-2.00">
      <input type="text" id="avg4" placeholder="-2.00">
      <input type="text" id="avg5" placeholder="-2.00">
      <input type="text" id="avg6" placeholder="-2.00">
    </div>
  </div>

  <!-- 下段（展示） -->
  <div class="panel" id="display-panel">
    <div class="line"></div>
    <div class="number-labels">
      <div>1</div><div>2</div><div>3</div><div>4</div><div>5</div><div>6</div>
    </div>
    <div class="circles-column" id="display-circles">
      <span class="circle" style="background:white;" data-index="0"></span>
      <span class="circle" style="background:black;" data-index="1"></span>
      <span class="circle" style="background:red;" data-index="2"></span>
      <span class="circle" style="background:blue;" data-index="3"></span>
      <span class="circle" style="background:yellow;" data-index="4"></span>
      <span class="circle" style="background:green;" data-index="5"></span>
    </div>
    <div class="inputs-column" id="display-inputs">
      <input type="text" id="disp1" placeholder="-2.00">
      <input type="text" id="disp2" placeholder="-2.00">
      <input type="text" id="disp3" placeholder="-2.00">
      <input type="text" id="disp4" placeholder="-2.00">
      <input type="text" id="disp5" placeholder="-2.00">
      <input type="text" id="disp6" placeholder="-2.00">
    </div>
  </div>

</div>

<script>
function setupPanel(panelId, inputIds) {
  const panel = document.getElementById(panelId);
  const inputs = inputIds.map(id => document.getElementById(id));
  const circles = panel.querySelectorAll('.circle');

  const minValue = -2.0;
  const maxValue = 1.0;

  // 黒線の位置を基準に0.00
  function getZeroPos(circle) {
    const line = panel.querySelector('.line');
    const lineRect = line.getBoundingClientRect();
    const panelRect = panel.getBoundingClientRect();
    return lineRect.left - panelRect.left; // px
  }

  function valueToPx(val, circleWidth) {
    const zeroPos = getZeroPos(circles[0]);
    const pxPerLeftUnit = zeroPos / 2; // -2.0 → zeroPos
    const pxPerRightUnit = (panel.clientWidth - zeroPos - circleWidth) / 1; // +1.0 → panel width - zeroPos
    if (val < 0) return zeroPos + val * pxPerLeftUnit - circleWidth; // 左側
    else return zeroPos + val * pxPerRightUnit; // 右側
  }

  function pxToValue(px, circleWidth) {
    const zeroPos = getZeroPos(circles[0]);
    const pxPerLeftUnit = zeroPos / 2;
    const pxPerRightUnit = (panel.clientWidth - zeroPos - circleWidth) / 1;
    if (px + circleWidth < zeroPos) return (px + circleWidth - zeroPos) / pxPerLeftUnit;
    else return (px - zeroPos) / pxPerRightUnit;
  }

  inputs.forEach((input, idx) => {
    // 初期位置
    circles[idx].style.left = valueToPx(minValue, circles[idx].offsetWidth) + 'px';
    input.value = minValue.toFixed(2);

    input.addEventListener('input', () => {
      let val = parseFloat(input.value);
      if (isNaN(val)) val = minValue;
      if (val < minValue) val = minValue;
      if (val > maxValue) val = maxValue;
      circles[idx].style.left = valueToPx(val, circles[idx].offsetWidth) + 'px';
      input.value = val.toFixed(2);
    });
  });

  circles.forEach((circle, idx) => {
    let dragging = false;
    let startX = 0;
    let startLeft = 0;

    const updateValue = (clientX) => {
      let deltaX = clientX - startX;
      let newLeft = startLeft + deltaX;
      // 左右制限
      const minLeft = valueToPx(minValue, circle.offsetWidth);
      const maxLeft = valueToPx(maxValue, circle.offsetWidth);
      if (newLeft < minLeft) newLeft = minLeft;
      if (newLeft > maxLeft) newLeft = maxLeft;
      circle.style.left = newLeft + 'px';
      let val = pxToValue(newLeft, circle.offsetWidth);
      if (val < minValue) val = minValue;
      if (val > maxValue) val = maxValue;
      inputs[idx].value = val.toFixed(2);
    };

    circle.addEventListener('mousedown', e => {
      dragging = true;
      startX = e.clientX;
      startLeft = parseFloat(circle.style.left);
      circle.style.cursor = 'grabbing';
    });
    document.addEventListener('mousemove', e => { if(dragging) updateValue(e.clientX); });
    document.addEventListener('mouseup', e => dragging = false);

    circle.addEventListener('touchstart', e => {
      dragging = true;
      startX = e.touches[0].clientX;
      startLeft = parseFloat(circle.style.left);
    });
    document.addEventListener('touchmove', e => {
      if(dragging) {
        e.preventDefault();
        updateValue(e.touches[0].clientX);
      }
    }, {passive:false});
    document.addEventListener('touch
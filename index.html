<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>STシミュレーター</title>
<style>
  html, body {
    margin: 0;
    padding: 0;
    height: 100%;
    width: 100%;
    overflow: hidden;
    font-family: sans-serif;
    background-color: #e0f7fa;
  }
  .table-container {
    display: flex;
    flex-direction: column;
    justify-content: space-between;
    height: 100%;
    padding: 10px;
    gap: 10px;
  }
  .panel {
    background-color: #b2ebf2;
    padding: 5px;
    border: 2px solid #00796b;
    border-radius: 10px;
    display: flex;
    position: relative;
    flex: 1;
    max-height: calc(50% - 14px); /* 上下段を縦方向10mmずつ小さく */
  }
  .line {
    position: absolute;
    left: 50%;
    top: 0;
    bottom: 0;
    width: 2px;
    background-color: black;
  }
  .circles-column {
    display: flex;
    flex-direction: column;
    justify-content: space-around;
    margin-right: 10px;
    position: relative;
    flex: 1;
  }
  .circle-row {
    display: flex;
    align-items: center;
    height: 0;
    position: relative;
  }
  .circle {
    width: 24px;
    height: 24px;
    border-radius: 50%;
    margin-left: 50%;
    position: relative;
    touch-action: none;
    cursor: grab;
    transition: transform 0.1s;
  }
  .inputs-column {
    display: flex;
    flex-direction: column;
    justify-content: space-around;
    height: 100%;
  }
  .inputs-column input {
    width: 60px;
    padding: 5px;
    text-align: center;
    font-size: 0.9rem;
  }
</style>
</head>
<body>

<div class="table-container">

  <!-- 上段（平均） -->
  <div class="panel" id="average-panel">
    <div class="line"></div>
    <div class="circles-column" id="average-circles">
      <div class="circle-row"><span class="circle" style="background:white;" data-index="0"></span> 1</div>
      <div class="circle-row"><span class="circle" style="background:black;" data-index="1"></span> 2</div>
      <div class="circle-row"><span class="circle" style="background:red;" data-index="2"></span> 3</div>
      <div class="circle-row"><span class="circle" style="background:blue;" data-index="3"></span> 4</div>
      <div class="circle-row"><span class="circle" style="background:yellow;" data-index="4"></span> 5</div>
      <div class="circle-row"><span class="circle" style="background:green;" data-index="5"></span> 6</div>
    </div>
    <div class="inputs-column" id="average-inputs">
      <input type="text" id="avg1" placeholder="0.00">
      <input type="text" id="avg2" placeholder="0.00">
      <input type="text" id="avg3" placeholder="0.00">
      <input type="text" id="avg4" placeholder="0.00">
      <input type="text" id="avg5" placeholder="0.00">
      <input type="text" id="avg6" placeholder="0.00">
    </div>
  </div>

  <!-- 下段（展示） -->
  <div class="panel" id="display-panel">
    <div class="line"></div>
    <div class="circles-column" id="display-circles">
      <div class="circle-row"><span class="circle" style="background:white;" data-index="0"></span> 1</div>
      <div class="circle-row"><span class="circle" style="background:black;" data-index="1"></span> 2</div>
      <div class="circle-row"><span class="circle" style="background:red;" data-index="2"></span> 3</div>
      <div class="circle-row"><span class="circle" style="background:blue;" data-index="3"></span> 4</div>
      <div class="circle-row"><span class="circle" style="background:yellow;" data-index="4"></span> 5</div>
      <div class="circle-row"><span class="circle" style="background:green;" data-index="5"></span> 6</div>
    </div>
    <div class="inputs-column" id="display-inputs">
      <input type="text" id="disp1" placeholder="0.00">
      <input type="text" id="disp2" placeholder="0.00">
      <input type="text" id="disp3" placeholder="0.00">
      <input type="text" id="disp4" placeholder="0.00">
      <input type="text" id="disp5" placeholder="0.00">
      <input type="text" id="disp6" placeholder="0.00">
    </div>
  </div>

</div>

<script>
function setupPanel(panelId, inputIds) {
  const panel = document.getElementById(panelId);
  const inputs = inputIds.map(id => document.getElementById(id));
  const circles = panel.querySelectorAll('.circle');

  inputs.forEach((input, idx) => {
    input.addEventListener('input', () => {
      let val = input.value.trim();
      let direction = 1;
      if(val.startsWith('F')) { val = val.replace('F',''); direction = 1; }
      else direction = -1;
      const num = parseFloat(val) || 0;
      circles[idx].style.transform = `translateX(${direction * num * 50}px)`;
    });
  });

  circles.forEach((circle, idx) => {
    let dragging = false;
    let startX = 0;
    let startPos = 0;

    const updateValue = (x) => {
      const delta = x - startX;
      let newTranslate = startPos + delta;
      if(newTranslate > 150) newTranslate = 150;
      if(newTranslate < -150) newTranslate = -150;
      circle.style.transform = `translateX(${newTranslate}px)`;
      const value = (Math.abs(newTranslate)/50).toFixed(2);
      inputs[idx].value = (newTranslate < 0 ? '' : 'F') + value;
    }

    circle.addEventListener('mousedown', e => {
      dragging = true;
      startX = e.clientX;
      startPos = parseFloat(circle.style.transform.replace('translateX(','').replace('px)','')) || 0;
      circle.style.cursor = 'grabbing';
    });
    document.addEventListener('mousemove', e => { if(dragging) updateValue(e.clientX); });
    document.addEventListener('mouseup', e => dragging = false);

    circle.addEventListener('touchstart', e => {
      dragging = true;
      startX = e.touches[0].clientX;
      startPos = parseFloat(circle.style.transform.replace('translateX(','').replace('px)','')) || 0;
    });
    document.addEventListener('touchmove', e => {
      if(dragging){ e.preventDefault(); updateValue(e.touches[0].clientX); }
    }, {passive:false});
    document.addEventListener('touchend', e => dragging = false);
  });
}

// 上段
setupPanel('average-panel', ['avg1','avg2','avg3','avg4','avg5','avg6']);
// 下段
setupPanel('display-panel', ['disp1','disp2','disp3','disp4','disp5','disp6']);
</script>

</body>
</html>
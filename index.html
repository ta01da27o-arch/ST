<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>STシミュレーター 左右可動版</title>
<style>
html, body {
  margin:0; padding:0; width:100%; height:100%;
  font-family:sans-serif; background:#fff; overflow:hidden;
}
.table-container {
  display:flex; flex-direction:column; justify-content:space-between;
  height:100%; padding:10px; gap:10px;
}
.panel {
  background:#00bfff; border:2px solid #00796b;
  border-radius:10px; display:flex; flex-direction:row;
  position:relative; flex:1; max-height:calc(50% - 14px);
}
.line {
  position:absolute; top:0; bottom:0; width:2px; background:#000;
  left:50%; z-index:0;
}
.number-labels {
  display:flex; flex-direction:column; justify-content:space-around;
  height:100%; width:20px; z-index:1;
}
.circles-column {
  display:flex; flex-direction:column; justify-content:space-around;
  align-items:flex-start; flex:1; position:relative; z-index:2;
}
.circle {
  width:24px; height:24px; border-radius:50%;
  cursor:grab; border:1px solid #000; position:absolute;
  transition:left 0.05s; z-index:2;
}
.value-label {
  position:absolute;
  font-size:0.9rem;
  width:40px;
  text-align:center;
  left:100%; top:50%;
  transform:translate(5px,-50%);
  z-index:3;
}
</style>
</head>
<body>

<div class="table-container">

  <!-- 上段 -->
  <div class="panel" id="average-panel">
    <div class="line"></div>
    <div class="number-labels">
      <div>1</div><div>2</div><div>3</div><div>4</div><div>5</div><div>6</div>
    </div>
    <div class="circles-column" id="average-circles">
      <span class="circle" style="background:white;" data-index="0"><span class="value-label">0.00</span></span>
      <span class="circle" style="background:black;" data-index="1"><span class="value-label">0.00</span></span>
      <span class="circle" style="background:red;" data-index="2"><span class="value-label">0.00</span></span>
      <span class="circle" style="background:blue;" data-index="3"><span class="value-label">0.00</span></span>
      <span class="circle" style="background:yellow;" data-index="4"><span class="value-label">0.00</span></span>
      <span class="circle" style="background:green;" data-index="5"><span class="value-label">0.00</span></span>
    </div>
  </div>

  <!-- 下段 -->
  <div class="panel" id="display-panel">
    <div class="line"></div>
    <div class="number-labels">
      <div>1</div><div>2</div><div>3</div><div>4</div><div>5</div><div>6</div>
    </div>
    <div class="circles-column" id="display-circles">
      <span class="circle" style="background:white;" data-index="0"><span class="value-label">0.00</span></span>
      <span class="circle" style="background:black;" data-index="1"><span class="value-label">0.00</span></span>
      <span class="circle" style="background:red;" data-index="2"><span class="value-label">0.00</span></span>
      <span class="circle" style="background:blue;" data-index="3"><span class="value-label">0.00</span></span>
      <span class="circle" style="background:yellow;" data-index="4"><span class="value-label">0.00</span></span>
      <span class="circle" style="background:green;" data-index="5"><span class="value-label">0.00</span></span>
    </div>
  </div>

</div>

<script>
function setupPanel(panelId){
  const panel=document.getElementById(panelId);
  const circles=panel.querySelectorAll('.circle');

  const minValue=-0.5;
  const maxValue=0.5;
  const zeroPos=panel.clientWidth/2; // 中央ライン
  const totalPixelsLeft=zeroPos-0;   // 左端から中央まで
  const totalPixelsRight=panel.clientWidth-zeroPos-circle.offsetWidth; // 右端まで

  circles.forEach((circle,idx)=>{
    const vertPos=idx*(panel.clientHeight/6)+(panel.clientHeight/12-circle.offsetHeight/2);
    circle.style.top=`${vertPos}px`;
    circle.style.left=`${zeroPos - circle.offsetWidth}px`;
    circle.dataset.value=0.0;
    circle.querySelector('.value-label').textContent='0.00';
  });

  circles.forEach((circle)=>{
    let dragging=false, startX=0, startValue=0;

    const moveCircle=(x)=>{
      let delta=x-startX;
      let newValue=startValue;

      // 左右線形マッピング
      if(startValue>=0){
        newValue=startValue + delta/totalPixelsRight*maxValue;
      } else {
        newValue=startValue + delta/totalPixelsLeft*-minValue;
      }

      if(newValue>maxValue)newValue=maxValue;
      if(newValue<minValue)newValue=minValue;

      const px=newValue>=0
        ? zeroPos + newValue/maxValue*totalPixelsRight - circle.offsetWidth
        : zeroPos + newValue/minValue*totalPixelsLeft - circle.offsetWidth;

      circle.style.left=`${px}px`;
      circle.dataset.value=newValue;
      circle.querySelector('.value-label').textContent=newValue.toFixed(2);
    };

    circle.addEventListener('mousedown',e=>{
      dragging=true; startX=e.clientX; startValue=parseFloat(circle.dataset.value);
      circle.style.cursor='grabbing';
    });
    document.addEventListener('mousemove',e=>{if(dragging) moveCircle(e.clientX);});
    document.addEventListener('mouseup',e=>dragging=false);

    circle.addEventListener('touchstart',e=>{
      dragging=true; startX=e.touches[0].clientX; startValue=parseFloat(circle.dataset.value);
    });
    document.addEventListener('touchmove',e=>{if(dragging){ e.preventDefault(); moveCircle(e.touches[0].clientX); }},{passive:false});
    document.addEventListener('touchend',e=>dragging=false);
  });
}

setupPanel('average-panel');
setupPanel('display-panel');
</script>

</body>
</html>